<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Sixnature Loyalty</title>
  <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/hiencamcam02/point.github.io/main/favicon.ico">
  <!-- DÃ¹ng CSS build sáºµn -->
  <link rel="stylesheet" href="style.css">
</head>
<body class="bg-green-50 min-h-screen flex items-center justify-center p-4">
  <div class="bg-white shadow-2xl rounded-2xl p-8 w-full max-w-md">
    <h1 class="text-2xl font-bold text-green-700 mb-6 text-center">
      ğŸŒ¿ Sixnature Loyalty
    </h1>

    <!-- Form tÃ¬m kiáº¿m -->
    <label class="block mb-2 text-gray-600">ğŸ“± Sá»‘ Ä‘iá»‡n thoáº¡i</label>
    <div class="flex mb-4">
      <input id="phone" type="text" placeholder="Nháº­p sá»‘ Ä‘iá»‡n thoáº¡i"
        class="flex-1 p-2 border rounded-l-lg focus:outline-none">
      <button onclick="searchCustomer()"
        class="bg-green-600 hover:bg-green-700 text-white px-4 rounded-r-lg">
        TÃ¬m
      </button>
    </div>

    <!-- Hiá»ƒn thá»‹ káº¿t quáº£ -->
    <div id="customerInfo" class="hidden mb-4 p-3 bg-green-100 rounded-lg"></div>

    <!-- ThÃªm khÃ¡ch hÃ ng má»›i -->
    <div id="newCustomerFields" class="hidden">
      <label class="block mb-2 text-gray-600">ğŸ‘¤ Há» tÃªn</label>
      <input id="name" type="text" placeholder="Nháº­p tÃªn khÃ¡ch hÃ ng"
        class="w-full p-2 border rounded mb-4">
    </div>

    <!-- Nháº­p Ä‘iá»ƒm -->
    <label class="block mb-2 text-gray-600">â­ Äiá»ƒm tÃ­ch</label>
    <input id="points" type="number" placeholder="+10 hoáº·c -5"
      class="w-full p-2 border rounded mb-4">

    <button onclick="savePoints()"
      class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 rounded-lg">
      ğŸ’¾ LÆ°u Ä‘iá»ƒm
    </button>

    <div id="message" class="mt-6 text-center text-gray-700"></div>
  </div>

  <script>
    const API_URL = "https://your-worker.workers.dev"; // ğŸ”¥ thay báº±ng Worker URL tháº­t

    let currentCustomer = null;

    async function searchCustomer() {
      const phone = document.getElementById("phone").value.trim();
      if (!phone) {
        alert("Vui lÃ²ng nháº­p sá»‘ Ä‘iá»‡n thoáº¡i");
        return;
      }

      document.getElementById("message").textContent = "â³ Äang tÃ¬m...";
      try {
        const res = await fetch(`${API_URL}?phone=${phone}`);
        const data = await res.json();

        const infoBox = document.getElementById("customerInfo");
        const newFields = document.getElementById("newCustomerFields");

        if (Object.keys(data).length === 0) {
          infoBox.classList.remove("hidden");
          infoBox.innerHTML = `<p class="text-red-600">KhÃ´ng tÃ¬m tháº¥y khÃ¡ch hÃ ng. Vui lÃ²ng nháº­p tÃªn Ä‘á»ƒ thÃªm má»›i.</p>`;
          newFields.classList.remove("hidden");
          currentCustomer = { phone };
        } else {
          infoBox.classList.remove("hidden");
          newFields.classList.add("hidden");
          infoBox.innerHTML = `
            <p><strong>ğŸ‘¤ TÃªn:</strong> ${data.name}</p>
            <p><strong>ğŸ“± SÄT:</strong> ${data.phone}</p>
            <p><strong>â­ Tá»•ng Ä‘iá»ƒm:</strong> ${data.points}</p>
          `;

          if (data.history && data.history.length > 0) {
            infoBox.innerHTML += "<p class='mt-2 font-semibold'>ğŸ“œ Lá»‹ch sá»­ gáº§n Ä‘Ã¢y:</p>";
            infoBox.innerHTML += "<ul class='list-disc ml-5 text-sm'>";
            data.history.slice(-5).reverse().forEach(h => {
              const date = new Date(h.time).toLocaleString("vi-VN");
              infoBox.innerHTML += `<li>${h.change > 0 ? "+" : ""}${h.change} Ä‘iá»ƒm lÃºc ${date}</li>`;
            });
            infoBox.innerHTML += "</ul>";
          }

          currentCustomer = data;
        }

        document.getElementById("message").textContent = "";
      } catch (err) {
        console.error(err);
        document.getElementById("message").textContent = "âŒ Lá»—i khi tÃ¬m khÃ¡ch hÃ ng";
      }
    }

    async function savePoints() {
      if (!currentCustomer) {
        alert("Vui lÃ²ng tÃ¬m khÃ¡ch hÃ ng trÆ°á»›c");
        return;
      }

      const phone = currentCustomer.phone;
      const name = document.getElementById("name").value.trim() || currentCustomer.name || "";
      const change = parseInt(document.getElementById("points").value);

      if (!change) {
        alert("Vui lÃ²ng nháº­p sá»‘ Ä‘iá»ƒm (cÃ³ thá»ƒ lÃ  Ã¢m hoáº·c dÆ°Æ¡ng)");
        return;
      }

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ phone, name, change })
        });
        const data = await res.json();

        alert(`âœ… LÆ°u thÃ nh cÃ´ng! Tá»•ng Ä‘iá»ƒm má»›i cá»§a ${data.name} (${data.phone}) lÃ  ${data.points}`);
        location.reload();
      } catch (err) {
        console.error(err);
        alert("âŒ Lá»—i khi lÆ°u Ä‘iá»ƒm");
      }
    }
  </script>
</body>
</html>
